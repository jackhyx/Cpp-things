* redis哨兵   热key    （不会没看过...）
#### 热点Key，怎么解决？
--什么是热Key？
在Redis中，我们把访问频率高的Key，称为热Key。
比如突然又几十万的请求去访问redis中某个特定的Key，那么这样会造成redis服务器短时间流量过于集中，
很可能导致redis的服务器宕机。那么接下来对这个Key的请求，都会直接请求到我们的后端数据库中，
数据库性能本来就不高，这样就可能直接压垮数据库，进而导致后端服务不可用。

--热Key产生的原因？
**用户消费的数据远大于生产的数据**，如商品秒杀、热点新闻、热点评论等读多写少的场景。
双十一秒杀商品，短时间内某个爆款商品可能被点击/购买上百万次，或者某条爆炸性新闻等被大量浏览，此时会造成一个较大的请求Redis量，这种情况下就会造成热点Key问题。
**请求分片集中，超过单台Redis服务器的性能极限**。
在服务端读数据进行访问时，往往会对数据进行分片切分，
例如采用固定Hash分片，hash落入同一台redis服务器，如果瞬间访问量过大，超过机器瓶颈时，就会导致热点 Key 问题的产生。
--热点Key的危害？
* 缓存击穿，压垮redis服务器，导致大量请求直接发往后端服务，并且DB本身性能较弱，很可能进一步导致后端服务雪崩。
* 如何识别热点Key？
  --凭借个人经验，结合业务场景，判断哪些是热Key。
  比如，双十一大促的时候，苹果手机正在秒杀，那么我们可以判断苹果手机这个sku就是热Key。
* 使用redis之前，在**客户端写程序统计上报**。
  修改我们的业务代码，在操作redis之前，加入Key使用次数的统计逻辑，定时把收集到的数据上报到统一的服务进行聚合计算，
  这样我们就可以找到那些热点Key。缺点就是对我们的业务代码有一定的侵入性。
* **服务代理层上报**。
  这个要看具体公司redis集群架构是怎么样的，如果是在redis前面有一个代理层，
  那么我们可以在代理层进行收集上报，也是可以找到热点Key。
* **使用redis自带的命令**。
  例如monitor、redis-cli加上--hotkeys选项等，不过这种方式执行起来很慢，可能会降低redis的处理请求的性能，慎用。
  monitor命令：可以实时抓取出redis服务器接收到的命令，然后写代码统计出热Key，也有现成的分析工具可以使用。
* **redis节点抓包分析**。
  自己写程序监听端口，解析数据，进行分析。

* 如何解决热Key问题？
  --Redis集群扩容：增加分片副本，分摊客户端发过来的读请求；
  --使用二级缓存，即JVM本地缓存，减少Redis的读请求。
  例如使用Caffeine+redis 实现二级缓存，先从本地缓存中取，取不到再去redis中去取。当然也可以使用其它框架，如ehcache、甚至一个HashMap都可以。
#### 布隆过滤器
使用布隆过滤器快速判断数据是否存在
#### redis 的set 等集合最多可以存储多少个元素
  redis官方文档
  Strings类型：一个String类型的value最大可以存储512M
  Lists类型：list的元素个数最多为2^32-1个，也就是4294967295个。
  Sets类型：元素个数最多为2^32-1个，也就是4294967295个。
  Hashes类型：键值对个数最多为2^32-1个，也就是4294967295个。
  Sorted sets类型：跟Sets类型相似。
#### redis主从复制？
#### redis hash怎么实现,zset怎么实现？
#### redis为什么怎么快？
#### redis的大key如何处理？
* redis的数据结构？

* redis的主从了解吗？

* redis的持久化方式？

* redis查找aa为前缀的所有数据，怎么查出来？

* redis的分布式锁怎么实现？

* Redis持久化

* redis中zset的底层结构

* 跳表能解决什么问题

* redis本身就是内存操作，比较快，为什么还用跳表做空间换时间

* redis为什么使用单线程

* redis的过期删除策略，定期删除和惰性删除

* 是否了解过其他数据库(除了MySQL和redis)

* redis为什么这么快，IO模型

* Redis的zset，set，hash，list，string的底层数据结构，以及应用场景。

* 跳表原理，hash用在购物车会出现什么问题

* zset怎么使用，自己设计一个场景题使用zset

* set实现给帖子点赞如何设计key和value

* 堆排序如何实现

* 令牌桶算法了解吗
  redis为啥可以做缓存
  redis做缓存一致性怎么解决
* 实现排行榜的zset指令是什么（zrangebyscore）。

* redis雪崩、穿透、击穿
* Redis使用什么机制提高了数据读取和写入的效率？
  Redis怎么保证可用性？
  Redis缓存穿透，缓存击穿，缓存雪崩以及解决方案
  redis的zset是怎么实现的？（哈希表＋跳表），跳表的节点有什么内容？跳表的查询过程是什么样的？复杂度是多少？redis的跳表是双向的，这样设计是为什么？
  Redis用途，持久化（RDB和AOF），启动数据加载流程（回答反了）
  Mysql InnoDB和myISAM区别，事务隔离级别，幻读本质
redis怎么设置过期的？（答给每个数据添加一个属性，过期时间，到了过期时间就删除，猜的）。怎么检查？（周期检查，惰性检查）。

redis是单线程的，为什么这么设计呢？（基于内存，瓶颈不在cpu， 加锁反而会带来性能损失）。 单线程一定比多线程好吗？为什么新版本的redis还要变成多线程的？（答 读多写少的时候，加共享锁多线程性能更好）， 那不考虑这种场景，读写差不多的情况下呢？

锁在内核中是怎么实现的呢？（瞎说了个锁总线）

多线程竞争一把锁，会不会出现一个线程永远抢不到锁的情况？这种问题该怎么解决？（答的是 等待久的优先级提升）
Redis分布式锁

如何保证加锁和释放锁是同一个线程操作的

Redis分布式锁容灾问题，如果一个Redis挂了会不会重复拿到这个锁

Redis主从同步

怎么决定主从同步是否需要强同步、异步同步或半同步

#### netstat的原理
netstat是通过读取 /proc/net/路径下的tcp、udp、unix等文件来获取连接信息的。
#### chmod指令 777含义
chmod命令
chmod（change mode）命令是控制用户对文件的权限的命令
**chmod可以使用八进制数来指定权限，无需再使用指定的权限和用户的字母来进行标识，通过读写执行等3个权限的数字来进行设置**
777表示什么
读+写+执行
因为文件的权限分为3种用户，分别为u（文件所有者）、g（文件的组用户）、o（其他用户），所以777表示u、g、o都是777的权限

#### 数据库中索引一般用什么数据结构？

#### B树和B+树有什么区别？

#### 怎么实现分布式锁？

#### 如果当前线程申请了分布式锁，还没处理完就锁的时间要到期了怎么办？
MySQL事务的特性以及底层实现原理

MVCC实现原理

#### 两阶段提交
为什么需要两阶段提交？
* 事务提交后，redo log 和 binlog 都要持久化到磁盘，但是这两个是独立的逻辑，可能出现半成功的状态，这样就造成两份日志之间的逻辑不一致。
举个例子，假设 id = 1 这行数据的字段 name 的值原本是 'jay'，然后执行 UPDATE t_user SET name = 'xiaolin' WHERE id = 1;
* 如果在持久化 redo log 和 binlog 两个日志的过程中，出现了半成功状态，那么就有两种情况：

如果在将 redo log 刷入到磁盘之后， MySQL 突然宕机了，而 binlog 还没有来得及写入。
MySQL 重启后，通过 redo log 能将 Buffer Pool 中 id = 1 这行数据的 name 字段恢复到新值 xiaolin，但是 binlog 里面没有记录这条更新语句，
在主从架构中，binlog 会被复制到从库，由于 binlog 丢失了这条更新语句，从库的这一行 name 字段是旧值 jay，与主库的值不一致性；
如果在将 binlog 刷入到磁盘之后， MySQL 突然宕机了，而 redo log 还没有来得及写入。
由于 redo log 还没写，崩溃恢复以后这个事务无效，所以 id = 1 这行数据的 name 字段还是旧值 jay，而 binlog 里面记录了这条更新语句，
在主从架构中，binlog 会被复制到从库，从库执行了这条更新语句，那么这一行 name 字段是新值 xiaolin，与主库的值不一致性；
可以看到，在持久化 redo log 和 binlog 这两份日志的时候，如果出现半成功的状态
就会造成主从环境的数据不一致性。
这是因为 redo log 影响主库的数据，binlog 影响从库的数据，所以 redo log 和 binlog 必须保持一致才能保证主从数据一致。

MySQL 为了避免出现两份日志之间的逻辑不一致的问题，使用了「两阶段提交」来解决，
* 两阶段提交其实是分布式事务一致性协议，它可以保证多个逻辑操作要不全部成功，要不全部失败，不会出现半成功的状态。

两阶段提交把单个事务的提交拆分成了 2 个阶段
分别是「准备（Prepare）阶段」和「提交（Commit）阶段」
每个阶段都由协调者（Coordinator）和参与者（Participant）共同完成。
注意，不要把提交（Commit）阶段和 commit 语句混淆了，commit 语句执行的时候，会包含提交（Commit）阶段。

#### 两阶段提交的过程是怎样的？
在 MySQL 的 InnoDB 存储引擎中
开启 binlog 的情况下，MySQL 会同时维护 binlog 日志与 InnoDB 的 redo log
为了保证这两个日志的一致性，MySQL 使用了内部 XA 事务
内部 XA 事务由 binlog 作为协调者，存储引擎是参与者。

当客户端执行 commit 语句或者在自动提交的情况下，MySQL 内部开启一个 XA 事务，分两阶段来完成 XA 事务的提交，如下图：
事务的提交过程有两个阶段，就是将 redo log 的写入拆成了两个步骤：
prepare 和 commit，中间再穿插写入binlog，具体如下：
prepare 阶段：将 XID（内部 XA 事务的 ID） 写入到 redo log，同时将 redo log 对应的事务状态设置为 prepare，
然后将 redo log 刷新到硬盘；
commit 阶段：把 XID 写入到 binlog，然后将 binlog 刷新到磁盘，
接着调用引擎的提交事务接口，将 redo log 状态设置为 commit（将事务设置为 commit 状态后，刷入到磁盘 redo log 文件，
所以 commit 状态也是会刷盘的）；

#### 刷盘的策略

#### MySQL的锁

#### 什么时候会加意向锁

#### 多个线程同时去操作一行很热的记录肯定会对行锁去竞争，怎么优化

#### MySQL出现死锁怎么解决
在数据库层面，有两种策略通过「打破循环等待条件」来解除死锁状态：
* 设置事务等待锁的超时时间。当一个事务的等待时间超过该值后，就对这个事务进行回滚，于是锁就释放了，另一个事务就可以继续执行了。
在 InnoDB 中，参数 innodb_lock_wait_timeout 是用来设置超时时间的，默认值时 50 秒。
* 开启主动死锁检测。主动死锁检测在发现死锁后，主动回滚死锁链条中的某一个事务，让其他事务得以继续执行。
* 将参数 innodb_deadlock_detect 设置为 on，表示开启这个逻辑，默认就开启。

上面这个两种策略是「当有死锁发生时」的避免方式。
我们可以回归业务的角度来预防死锁，对订单做幂等性校验的目的是为了保证不会出现重复的订单
那我们可以直接将 order_no 字段设置为唯一索引列，利用它的唯一下来保证订单表不会出现重复的订单，
不过有一点不好的地方就是在我们插入一个已经存在的订单记录时就会抛出异常。

#### binlog有哪几种格式
binlog 有 3 种格式类型，分别是 STATEMENT（默认格式）、ROW、 MIXED，区别如下：
* STATEMENT：每一条修改数据的 SQL 都会被记录到 binlog 中
（相当于记录了逻辑操作，所以针对这种格式， binlog 可以称为逻辑日志），主从复制中 slave 端再根据 SQL 语句重现。
但 STATEMENT 有动态函数的问题，比如你用了 uuid 或者 now 这些函数，你在主库上执行的结果并不是你在从库执行的结果，
这种随时在变的函数会导致复制的数据不一致；
* ROW：记录行数据最终被修改成什么样了（这种格式的日志，就不能称为逻辑日志了），不会出现 STATEMENT 下动态函数的问题。
* 但 ROW 的缺点是每行数据的变化结果都会被记录，比如执行批量 update 语句，更新多少行数据就会产生多少条记录，
* 使 binlog 文件过大，而在 STATEMENT 格式下只会记录一个 update 语句而已；
* MIXED：包含了 STATEMENT 和 ROW 模式，它会根据不同的情况自动使用 ROW 模式和 STATEMENT 模式；


#### redo log 和 binlog 有什么区别？
这两个日志有四个区别。
* 适用对象不同：
binlog 是 MySQL 的 Server 层实现的日志，所有存储引擎都可以使用；
redo log 是 Innodb 存储引擎实现的日志；
* 文件格式不同：
binlog 有 3 种格式类型，分别是 STATEMENT（默认格式）、ROW、 MIXED，区别如下：
STATEMENT：每一条修改数据的 SQL 都会被记录到 binlog 中（相当于记录了逻辑操作，所以针对这种格式， binlog 可以称为逻辑日志），主从复制中 slave 端再根据 SQL 语句重现。但 STATEMENT 有动态函数的问题，比如你用了 uuid 或者 now 这些函数，你在主库上执行的结果并不是你在从库执行的结果，这种随时在变的函数会导致复制的数据不一致；
ROW：记录行数据最终被修改成什么样了（这种格式的日志，就不能称为逻辑日志了），不会出现 STATEMENT 下动态函数的问题。但 ROW 的缺点是每行数据的变化结果都会被记录，比如执行批量 update 语句，更新多少行数据就会产生多少条记录，使 binlog 文件过大，而在 STATEMENT 格式下只会记录一个 update 语句而已；
MIXED：包含了 STATEMENT 和 ROW 模式，它会根据不同的情况自动使用 ROW 模式和 STATEMENT 模式；
redo log 是物理日志，记录的是在某个数据页做了什么修改，比如对 XXX 表空间中的 YYY 数据页 ZZZ 偏移量的地方做了AAA 更新；
* 写入方式不同：
binlog 是追加写，写满一个文件，就创建一个新的文件继续写，不会覆盖以前的日志，保存的是全量的日志。
redo log 是循环写，日志空间大小是固定，全部写满就从头开始，保存未被刷入磁盘的脏页日志。
* 用途不同：
binlog 用于备份恢复、主从复制；
redo log 用于掉电等故障恢复。
如果不小心整个数据库的数据被删除了，能使用 redo log 文件恢复数据吗？
不可以使用 redo log 文件恢复，只能使用 binlog 文件恢复。
因为 redo log 文件是循环写，是会边写边擦除日志的，只记录未被刷入磁盘的数据的物理日志，已经刷入磁盘的数据都会从 redo log 文件里擦除。
binlog 文件保存的是全量的日志，也就是保存了所有数据变更的情况，理论上只要记录在 binlog 上的数据，都可以恢复，
* 所以如果不小心整个数据库的数据被删除了，得用 binlog 文件恢复数据


### MySQL常见索引类型和使用场景

B+和B树的区别，B+树有什么好处

覆盖索引

最左前缀原则

MySQL主从同步的过程

explain语句
19、如果还需要是可重入锁呢？应该怎么设计？
MySql的执行流程
Innodb的行锁是怎么实现的，
隔离级别
Limit分页的执行流程
2.mysql如何查看最近慢查询。
3.mysql索引什么情况下会失效,  为什么会失效。
4.索引的数据结构，  巴拉巴拉说了一大堆。
5.锁的类型 巴拉巴拉又说了一大堆。
6.动态链接库，静态链接库
7.redis的数据类型。


怎么保证数据库和缓存中的一致性

如果插入了新数据库，需要往缓存里存吗

如果是更新数据库，然后更新缓存，会有什么问题


数据库：

性能调优

#### varchar类型的索引，可以前缀匹配吗
前缀索引是指对字符类型字段的前几个字符建立的索引，而不是在整个字段上建立的索引，
前缀索引可以建立在字段类型为 char、 varchar、binary、varbinary 的列上。

#### mysql主从复制了解吗

#### MYSQL

#### 数据库的join区别

数据库和缓存的一致性

MySQL的存储引擎？除了Innodb和MyISAM还了解其他的存储引擎吗？

了解索引吗？聚集索引和非聚集索引的区别?

你MySQL运用的场景有哪些？

建表的mysql语句？

索引用过吗？

举了一个联合索引，select * ..... 会不会走索引？

自己有没有设置表？用户表？有没有设计索引？

varchar了解吗？10的长度可以存20吗？
* mysql为什么用B+树，B+树为啥是m叉树不是二叉树

* 单列索引，如果查询的字段不是主键，一定会搜索两次吗？

* 事务的隔离界别，说一下幻读

* b+树的特点

* MySQL 的乐观锁和悲观锁

* 什么语句会加锁？

* 如果知道表的结构，执行 UPDATE 语句你能判断在大概在哪个位置吗？

* 一个事务执行 UPDATE 语句时，执行时间比较长，此时另外一个事务也执行一样的 UPDATE 语句，会出现什么问题？

* 介绍MySQL索引

* 为什么使用B+树而不用B树

* B树适合什么应用场景

* 索引的最左前缀匹配
  
* 索引下推

* 覆盖索引了解吗？

* MySQL事务隔离级别，主要解决哪些问题

* 幻读和脏读的区别

* 幻读怎么避免的 / 事务串行化怎么实现

* 数据库，MVCC了解吗

* 索引匹配原则；

* 给了个sql和一些约束，具体不记得了，问走了索引没，为什么？又写了sql，具体不记得了，问加锁没，加了什么锁？

* mysql的悲观锁和乐观锁怎么实现的

* 为啥用B+树索引，B树索引有什么好处

* Hash为啥不建议做索引数据结构


* mysql相关，mvcc、索引、redolog、undolog、binlog
  mysql事务、事务特性

mysql如何回滚
事务，通过什么实现？除了行锁还有什么？
索引相关
（1）单列索引 a和b select  where a= and b= 先查哪个 那个区分度大查那个 名字>年龄
（2）联合索引 a，b，c 然后查 b，c 会不会用到索引
（3）主键索引和单列索引区别

索引为什么选B+(对比红黑树、哈希表、B树)

如何提高数据库检索速度、索引



数据库 幻读了解吗？

redis几种类型

mysql索引

怎么建立索引？


外键需要索引吗


#### 怎么对数据库做的优化？

#### 你用的pgsql,我不太了解，能讲讲和mysql的区别吗？

#### pgsql如何保证数据一致性？单写是什么？

#### pg和mysql引擎上有什么区别？底层有什么区别？

pg做了哪些优化？底层？

#### 索引？有哪些？有什么特性？

#### 如果删除索引出现问题了导致锁表怎么办？

#### 死锁怎么办？


#### b + 树说一下？索引结构？

#### hash说一下？

#### hash为什么不能范围查找？

#### 索引结构？

#### 聚集索引和非聚集索引？

#### 回表？怎么减少回表？回表出现错误怎么办

#### 产生回表的原因？

#### 举一个需要回表的例子？

#### 什么是索引覆盖？

还有很多问题。。。以及记不清了，反正都是数据库，数据库，数据库。。。。。。。mlb
Redis是否了解过底层？
zset的跳表如何实现的？
Redis如何实现分布式锁
Redis怎么实现限制用户请求的？怎么计数+1的？如果多条线程过来怎么保证线程安全？
AOF和RDB有啥优缺点？AOF重写了解过吗？
缓存穿透，缓存击穿，缓存雪崩，什么概念和解决方案
Redis如何淘汰过期数据？
Kafka使用场景？为什么用？为什么吞吐量高？
MQ如何保证消息不丢失
#### mysql的四大隔离级别，分别解释，并会出现什么问题

#### 解释什么是幻读

#### 解释mvcc

#### 解释 当前读怎么解决幻读问题

#### mysql 的锁有哪几种除了表锁和行锁